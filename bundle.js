!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var r=function(t,e){var n=document.getElementById(e),r=n.getContext("2d"),o=n.width/5;n.width=5*o,n.height=4*o,r.fillStyle="black",r.fillRect(0,0,5*o,4*o);for(var i=t.initialState,u=0;u<i.length;u++)r.fillStyle=t.color,r.fillRect(o*(i[u][1]-t.x+(5-t.width)/2),o*(i[u][0]-t.y+(4-t.height)/2),o,o)};function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var i=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:21,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.height=n,this.width=r,this.grid=new Array(this.height).fill().map(function(t){return new Array(e.width).fill(0)}),this.currentPiece=void 0,this.currentPos=[],this.currentPosState=void 0}var e,n,r;return e=t,(n=[{key:"setCurrentPiece",value:function(t){this.currentPiece=t,this.currentPos=t.initialState,this.currentPosState=0,this.move("startingPos")}},{key:"move",value:function(t){var e=this.currentPos,n=this.currentPiece.move(t,e);if(this._isValidMove(e,n))this._updateGrid(e,n);else if("down"===t)return!0}},{key:"clearRows",value:function(){var t=this,e=[];return this.currentPos.forEach(function(n){t._isOnGrid(n)&&t.grid[n[0]].every(function(t){return t})&&!e.includes(n[0])&&e.push(n[0])}),e.sort(function(t,e){return t-e}),e.forEach(function(e){t.grid.splice(e,1),t.grid.unshift(new Array(10).fill(0))}),e.length}},{key:"_isValidMove",value:function(t,e){for(var n=0;n<e.length;n++){var r=e[n];if(r[1]<0)return!1;if(r[1]>9)return!1;if(r[0]>20)return!1;if(this._isOnGrid(r)&&this.grid[r[0]][r[1]]&&!this._includesBlock(t,r))return!1}return!0}},{key:"_includesBlock",value:function(t,e){for(var n=0;n<t.length;n++)if(t[n][0]===e[0]&&t[n][1]===e[1])return!0;return!1}},{key:"_isOnGrid",value:function(t){return!!this.grid[t[0]]}},{key:"_drawGrid",value:function(){!function(t){var e=document.getElementById("tetris"),n=e.getContext("2d"),r=e.width/10;e.width=10*r,e.height=20*r,n.clearRect(0,0,10*r,20*r);for(var o=0;o<t.length;o++)for(var i=0;i<t[0].length;i++)n.fillStyle=t[o][i]||"black",n.fillRect(i*r,(o-1)*r,r,r),n.strokeStyle="rgba(255,255,255,0.2)",n.strokeRect(i*r,(o-1)*r,r,r)}(this.grid)}},{key:"_updateGrid",value:function(t,e){var n=this;e.forEach(function(t){n._isOnGrid(t)&&(n.grid[t[0]][t[1]]=n.currentPiece.color)}),t.forEach(function(t){n._isOnGrid(t)&&!n._includesBlock(e,t)&&(n.grid[t[0]][t[1]]=0)}),this._drawGrid(),this.currentPos=e}},{key:"rotateClockwise",value:function(){var t=this.currentPos,e=(this.currentPosState+1)%this.currentPiece.numStates,n=this.currentPiece.rotationMap[e],r=t.map(function(t,e){var r=t.slice();return r[0]+=n[e][0],r[1]+=n[e][1],r});this._isValidMove(t,r)&&(this._updateGrid(t,r),this.currentPosState=(this.currentPosState+1)%this.currentPiece.numStates)}},{key:"rotateCounterClockwise",value:function(){var t=this.currentPos,e=this.currentPosState,n=this.currentPiece.rotationMap[e],r=t.map(function(t,e){var r=t.slice();return r[0]-=n[e][0],r[1]-=n[e][1],r});this._isValidMove(t,r)&&(this._updateGrid(t,r),this.currentPosState=(this.currentPosState-1+this.currentPiece.numStates)%this.currentPiece.numStates)}}])&&o(e.prototype,n),r&&o(e,r),t}();function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var c=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.actions=e,this.eventHandler=this.eventHandler.bind(this),document.addEventListener("keydown",this.eventHandler)}var e,n,r;return e=t,(n=[{key:"eventHandler",value:function(t){this.actions[t.code]&&this.actions[t.code]()}},{key:"removeEventListener",value:function(){document.removeEventListener("keydown",this.eventHandler)}}])&&u(e.prototype,n),r&&u(e,r),t}();function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var f=function(){function t(e,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new i;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.board=o,this.difficulty=n,this.colors=r,this.pieces=e,this.score=0,this.level=1,this.bag=[],this.timeOut=void 0,this._fillAndShuffleBag(),this.currentPiece=this.bag.shift(),this.keyMap=void 0,this.rowsCleared=0,this._tick=this._tick.bind(this),this._setKeyMap=this._setKeyMap.bind(this)}var e,n,o;return e=t,(n=[{key:"play",value:function(){this._setKeyMap(),this._setNextPiece()}},{key:"_setKeyMap",value:function(){var t=this;this.keyMap=new c({KeyA:function(){t.board.rotateCounterClockwise()},KeyS:function(){return t.board.rotateClockwise()},ArrowUp:function(){return t.board.rotateClockwise()},ArrowDown:function(){return t.move("down")},ArrowLeft:function(){return t.move("left")},ArrowRight:function(){return t.move("right")}})}},{key:"move",value:function(t){this.board.move(t)&&this._freezePiece()}},{key:"_setNextPiece",value:function(){this.board.setCurrentPiece(this.currentPiece),this.currentPiece=this.bag.shift(),r(this.currentPiece,"next-piece"),this._tick(),0===this.bag.length&&this._fillAndShuffleBag()}},{key:"_clearRows",value:function(){var t=document.getElementById("rows"),e=this.board.clearRows();return this.rowsCleared+=e,t.innerHTML=this.rowsCleared,e}},{key:"_setScore",value:function(t){var e=document.getElementById("score");this.score+=25*this.level*Math.pow(2,t);var n=this.score.toString();e.innerHTML=n}},{key:"_updateLevel",value:function(){var t=document.getElementById("level");this.level<10&&(this.level=Math.floor(this.rowsCleared/10)+this.difficulty),t.innerHTML=this.level}},{key:"_freezePiece",value:function(){clearTimeout(this.timeOut);var t=this._clearRows();this._setScore(t),this._updateLevel(),this._gameOver()?console.log("GameOver"):this._setNextPiece()}},{key:"_tick",value:function(){this.board.move("down")?this._freezePiece():this.timeOut=setTimeout(this._tick,75*(11-this.level))}},{key:"_gameOver",value:function(){var t=this.board.grid[0].some(function(t){return t});return t&&this.keyMap.removeEventListener(),t}},{key:"_fillAndShuffleBag",value:function(){for(var t=[],e=0;e<4;e++)t=t.concat(this.pieces);for(var n=t.length-1;n>=0;n--){var r=Math.floor(Math.random()*n),o=[t[r],t[n]];t[n]=o[0],t[r]=o[1]}this.bag=t}}])&&a(e.prototype,n),o&&a(e,o),t}();function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var l={right:{idx:1,shift:1},left:{idx:1,shift:-1},down:{idx:0,shift:1},startingPos:{idx:1,shift:5}},h=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.color=e}var e,n,r;return e=t,(n=[{key:"move",value:function(t,e){return e.map(function(e){var n=e.slice(),r=l[t],o=r.idx,i=r.shift;return n[o]+=i,n})}}])&&s(e.prototype,n),r&&s(e,r),t}();function y(t){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function p(t,e){return!e||"object"!==y(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var v=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=p(this,b(e).call(this,t))).height=1,n.width=4,n.x=-2,n.y=0,n.initialState=[[0,-2],[0,-1],[0,0],[0,1]],n.numStates=2,n.rotationMap={0:[[2,-2],[1,-1],[0,0],[-1,1]],1:[[-2,2],[-1,1],[0,0],[1,-1]]},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}(e,h),e}();function m(t){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function w(t,e){return!e||"object"!==m(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function _(t){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function g(t,e){return(g=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var S=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=w(this,_(e).call(this,t))).height=2,n.width=3,n.x=-1,n.y=-1,n.initialState=[[0,-1],[0,0],[-1,0],[-1,1]],n.numStates=2,n.rotationMap={0:[[0,-2],[1,-1],[0,0],[1,1]],1:[[0,2],[-1,1],[0,0],[-1,-1]]},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&g(t,e)}(e,h),e}();function O(t){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function P(t,e){return!e||"object"!==O(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function j(t){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function k(t,e){return(k=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var E=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=P(this,j(e).call(this,t))).height=2,n.width=3,n.x=-1,n.y=-1,n.initialState=[[-1,-1],[-1,0],[-1,1],[0,0]],n.numStates=4,n.rotationMap={0:[[-1,-1],[0,0],[1,1],[1,-1]],1:[[-1,1],[0,0],[1,-1],[-1,-1]],2:[[1,1],[0,0],[-1,-1],[-1,1]],3:[[1,-1],[0,0],[-1,1],[1,1]]},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&k(t,e)}(e,h),e}();function C(t){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function x(t,e){return!e||"object"!==C(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function M(t){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function B(t,e){return(B=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var T=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=x(this,M(e).call(this,t))).height=2,n.width=3,n.x=-1,n.y=-1,n.initialState=[[0,1],[0,0],[-1,0],[-1,-1]],n.numStates=2,n.rotationMap={0:[[0,2],[1,1],[0,0],[1,-1]],1:[[0,-2],[-1,-1],[0,0],[-1,1]]},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&B(t,e)}(e,h),e}();function F(t){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function R(t,e){return!e||"object"!==F(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function A(t){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function L(t,e){return(L=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var G=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=R(this,A(e).call(this,t))).height=2,n.width=2,n.x=-1,n.y=-1,n.initialState=[[-1,-1],[-1,0],[0,0],[0,-1]],n.numStates=1,n.rotationMap={0:[[0,0],[0,0],[0,0],[0,0]]},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&L(t,e)}(e,h),e}();function D(t){return(D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function H(t,e){return!e||"object"!==D(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function I(t){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function K(t,e){return(K=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var V=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=H(this,I(e).call(this,t))).height=2,n.width=3,n.x=-1,n.y=-1,n.initialState=[[-1,-1],[-1,0],[-1,1],[0,1]],n.numStates=4,n.rotationMap={0:[[-1,-1],[0,0],[1,1],[2,0]],1:[[-1,1],[0,0],[1,-1],[0,-2]],2:[[2,1],[1,0],[0,-1],[-1,0]],3:[[0,-1],[-1,0],[-2,1],[-1,2]]},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&K(t,e)}(e,h),e}();function z(t){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function N(t,e){return!e||"object"!==z(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function U(t){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function q(t,e){return(q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var J=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=N(this,U(e).call(this,t))).height=2,n.width=3,n.x=-1,n.y=-1,n.initialState=[[-1,-1],[-1,0],[-1,1],[0,-1]],n.numStates=4,n.rotationMap={0:[[-1,-1],[0,0],[1,1],[0,-2]],1:[[-1,1],[0,0],[1,-1],[-2,0]],2:[[2,1],[1,0],[0,-1],[1,2]],3:[[0,-1],[-1,0],[-2,1],[1,0]]},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&q(t,e)}(e,h),e}();var Q=["#E8B8AB","#B9CBFF","#A0E8B5","#14CFBD","#D68E05","#FFF19C","#D6AFFF"];document.addEventListener("DOMContentLoaded",function(){var t=document.getElementById("tetris"),e=t.getContext("2d"),n=t.width/10;t.width=10*n,t.height=20*n,e.fillStyle="lightgrey",e.fillRect(0,0,10*n,20*n);var o=document.getElementById("play");o.addEventListener("click",function t(){u.play(),o.removeEventListener("click",t)});var i=[];i.push(new J("#E8B8AB")),i.push(new G("#B9CBFF")),i.push(new V("#A0E8B5")),i.push(new S("#14CFBD")),i.push(new T("#D68E05")),i.push(new v("#FFF19C")),i.push(new E("#D6AFFF"));var u=new f(i,1,Q);window.game=u,r(i[0],"saved-piece"),r(i[1],"next-piece")})}]);
//# sourceMappingURL=bundle.js.map